



Network Working Group                              K. Vairavakkalai, Ed.
Internet-Draft                                      N. Venkataraman, Ed.
Updates: 4456 (if approved)                       Juniper Networks, Inc.
Intended status: Experimental                           16 February 2024
Expires: 19 August 2024


                 BGP Route Reflector in Forwarding Path
                      draft-ietf-idr-bgp-fwd-rr-01

Abstract

   The procedures in BGP Route Reflection (RR) spec [RFC4456] primarily
   deal with scenarios where the RR is reflecting BGP routes with next
   hop unchanged.

   These procedures can sometimes result in traffic forwarding loops in
   deployments where the RR is in forwarding path, because of reflecting
   BGP routes with next hop set to self.

   This document specifies approaches to minimize possiblity of such
   traffic forwarding loops.  One of those approaches updates path
   selection procedures specified in Section 9 of BGP RR.  [RFC4456]

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 RFC 2119 [RFC2119] RFC 8174 [RFC8174] when, and only when, they
   appear in all capitals, as shown here.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 19 August 2024.



Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 1]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


Copyright Notice

   Copyright (c) 2024 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Avoiding Loops Between Route Reflectors in Forwarding Path  .   3
     3.1.  Path selection change . . . . . . . . . . . . . . . . . .   4
     3.2.  Other mechanisms  . . . . . . . . . . . . . . . . . . . .   4
   4.  Managabeality Considerations  . . . . . . . . . . . . . . . .   5
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   5
     7.2.  Informative References  . . . . . . . . . . . . . . . . .   6
   Appendix A.  Appendix . . . . . . . . . . . . . . . . . . . . . .   6
     A.1.  Document History  . . . . . . . . . . . . . . . . . . . .   6
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .   6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   6

1.  Introduction

   The procedures in BGP Route Reflection (RR) spec [RFC4456] primarily
   deal with scenarios where the RR is reflecting BGP routes with next
   hop unchanged.

   These procedures can sometimes result in traffic forwarding loops in
   deployments where the RR is in forwarding path, and is reflecting BGP
   routes with next hop set to self.  RR with next hop self is used at
   ABR nodes in Inter-AS Option C (Section 10, [RFC4364]) deployments.

   This document specifies approaches to minimize possiblity of such
   traffic forwarding loops.  One of those approaches updates path
   selection procedures specified in Section 9 of BGP RR.  [RFC4456]





Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 2]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


2.  Terminology

   ABR: Area Border Router

   AS: Autonomous System

   AFI: Address Family Identifier

   BN: Border Node

   EP: Endpoint, e.g. a loopback address in the network

   MPLS: Multi Protocol Label Switching

   PE: Provider Edge

   SAFI: Subsequent Address Family Identifier

3.  Avoiding Loops Between Route Reflectors in Forwarding Path

                  [RR26]      [RR27]                       [RR16]
                   |            |                             |
                   |            |                             |
                   |+-[ABR23]--+|+--[ASBR21]---[ASBR13]-+|+--[PE11]--+
                   ||          |||          `  /        |||          |
  [CE41]--[PE25]--[P28]       [P29]          `/        [P15]     [CE31]
                   |           | |           /`         | |          |
                   |           | |          /  `        | |          |
                   |           | |         /    `       | |          |
                   +--[ABR24]--+ +--[ASBR22]---[ASBR14]-+ +--[PE12]--+


         |      AS2       |         AS2      |                   |
     AS4 +    region-1    +      region-2    +       AS1         + AS3
         |                |                  |                   |


  203.0.113.41  ------------ Traffic Direction ---------->  203.0.113.31

     Figure 1: Reference Topology: Inter-domain BGP Transport Network

      A pair of redundant ABRs (ABR23, ABR24 in Figure 1), each acting
      as an RR with next hop self, may choose each other as best path
      towards egress PE11, instead of the upstream ASBR (ASBR21 or
      ASBR22), causing a traffic forwarding loop.






Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 3]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


      This happens because of following the path selection rule
      specified in Section 9 of BGP RR [RFC4456] that tie-breaks on
      ORIGINATOR_ID before CLUSTER_LIST.  RFC4456 considers pure RR
      functionality which leaves next hop unchanged.

      When a RR inserts itself in forwarding path because of reflecting
      routes with next hop self, as is the case for ABR BNs in an Inter-
      AS Option C (Section 10 [RFC4364]) BGP transport network, this
      rule may cause loops.

      This problem can happen for routes of any BGP address family,
      including BGP LU (1/4 or 2/4) and BGP CT (AFI/SAFIs: 1/76 or
      2/76).

      Using one or more of the following approaches softens the
      possibility of such loops in a network with redundant ABRs.

3.1.  Path selection change

      Implementations SHOULD provide a way to alter the tie-breaking
      rule specified in Section 9 of BGP RR [RFC4456] so as to tie-break
      on CLUSTER_LIST step before ORIGINATOR_ID step, when performing
      path selection for BGP routes.

      This document suggests the following modification to the BGP
      Decision Process Tie Breaking rules (Section 9.1.2.2 of [RFC4271])
      that can be applied to path selection of BGP routes:

      The following rule SHOULD be inserted between Steps e) and f): a
      BGP Speaker SHOULD prefer a route with the shorter CLUSTER_LIST
      length.  The CLUSTER_LIST length is zero if a route does not carry
      the CLUSTER_LIST attribute.

3.2.  Other mechanisms

      Some other deployment considerations, if feasible, can also help
      in avoiding this problem:

      -  Configuring the same CLUSTER_ID at the redundant ABR nodes.
         CLUSTER_ID Loop check will make routes reflected by an ABR
         unusable at redundant ABRs.

      -  IGP metric assignment, such that "ABR to redundant ABR" cost is
         inferior to "ABR to upstream ASBR" cost.







Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 4]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


      -  Using procedures described in [BGP-CT] , tunnels belonging to
         non 'best effort' Transport Classes not be provisioned between
         ABRs.  This will ensure that the BGP CT route received from an
         ABR with next hop self will be unusable at a redundant ABR.

4.  Managabeality Considerations

      The path selection change mentioned in Section 3.1 can be deployed
      incrementally at the redundant ABRs, since the forwarding loop
      would break when one of the ABRs stops chosing the other as best
      path.  Neverthless, it is recommended to consistently provision
      the path selection change on all redundant ABR/RR nodes in a
      domain.  This provides consistent route selection at the transport
      layer ABRs in the IBGP domain.

      The operator should carefully consider the overall impact of any
      of these options on a specific network deployment.

5.  IANA Considerations

   This document makes no new requests of IANA.

6.  Security Considerations

   This document does not change the underlying security issues inherent
   in the existing BGP protocol, such as those described in [RFC4271],
   [RFC4272] and [RFC4456].

   Mehanisms described in this document reduce possibility of loops
   within an IBGP domain.  They do not affect routing across EBGP
   sessions.

7.  References

7.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC4271]  Rekhter, Y., Ed., Li, T., Ed., and S. Hares, Ed., "A
              Border Gateway Protocol 4 (BGP-4)", RFC 4271,
              DOI 10.17487/RFC4271, January 2006,
              <https://www.rfc-editor.org/info/rfc4271>.






Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 5]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


   [RFC4272]  Murphy, S., "BGP Security Vulnerabilities Analysis",
              RFC 4272, DOI 10.17487/RFC4272, January 2006,
              <https://www.rfc-editor.org/info/rfc4272>.

   [RFC4456]  Bates, T., Chen, E., and R. Chandra, "BGP Route
              Reflection: An Alternative to Full Mesh Internal BGP
              (IBGP)", RFC 4456, DOI 10.17487/RFC4456, April 2006,
              <https://www.rfc-editor.org/info/rfc4456>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

7.2.  Informative References

   [BGP-CT]   Vairavakkalai, Ed. and Venkataraman, Ed., "BGP Classful
              Transport Planes", 22 September 2023,
              <https://datatracker.ietf.org/doc/html/draft-ietf-idr-bgp-
              ct-16>.

   [RFC4364]  Rosen, E. and Y. Rekhter, "BGP/MPLS IP Virtual Private
              Networks (VPNs)", RFC 4364, DOI 10.17487/RFC4364, February
              2006, <https://www.rfc-editor.org/info/rfc4364>.

Appendix A.  Appendix

A.1.  Document History

   The content in this document was introduced as part of [BGP-CT].  But
   because the described problem is not specific to BGP CT and is useful
   for other BGP families also, it is being extracted out to this
   separate document.

Acknowledgements

   The authors thank Jeff Haas, Jon Hardwick, Keyur Patel, Robert
   Raszuk, Susan Hares for the discussions and review comments.

Authors' Addresses

   Kaliraj Vairavakkalai (editor)
   Juniper Networks, Inc.
   1133 Innovation Way,
   Sunnyvale, CA 94089
   United States of America
   Email: kaliraj@juniper.net





Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 6]

Internet-Draft       BGP Forwarding Route Reflector        February 2024


   Natrajan Venkataraman (editor)
   Juniper Networks, Inc.
   1133 Innovation Way,
   Sunnyvale, CA 94089
   United States of America
   Email: natv@juniper.net













































Vairavakkalai & VenkataraExpires 19 August 2024                 [Page 7]
